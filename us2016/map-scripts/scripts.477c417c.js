"use strict";angular.module("c2App",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/map.html"}).otherwise({redirectTo:"/"})}]),angular.module("c2App").factory("colorService",function(){var a={},b={"Heavy Republican":"#CC4731","Heavy Democrat":"#306596",Democrat:"#667FAF","Light Democrat":"#A9C0DE",Republican:"#CA5E5B","Light Republican":"#EAA9A8",Neutral:"grey",defaultFill:"#EDDC4E"};return a.fills=function(){return b},a}),angular.module("c2App").factory("dataService",["$http",function(a){function b(b,c){var d="http://"+f.name+":"+f.port+"/"+b;a.get(d).success(function(a){c(a)})}var c={},d=(new Date).toISOString().substr(0,10),e={},f={name:"ec2-54-154-200-189.eu-west-1.compute.amazonaws.com",port:8091};return console.log("using",f),c.fetchDataSets=function(a){b("dataSets",a)},c.fetchInput=function(a,c){var f=function(b){e[a]=b,console.log("cache updated for "+a),c(b)};a!==d?a in e?c(e[a]):b("input/"+a,f):b("input/"+a,c)},c}]);const upper_light=500,upper_medium=5e3;var map;angular.module("c2App").controller("MapCtrl",["$scope","colorService","dataService",function(a,b,c){function d(a,b){var c='<div class="hoverinfo">'+a.properties.name+"<br/>";return c+='<span style="white-space: nowrap">Electoral Votes: '+b.electoralVotes+"</span><br>",c+='<span style="white-space: nowrap">Total: '+b.total+"</span><br>",c+='<span style="white-space: nowrap">Trump: '+b.trump+"/"+b.trump_precentage+"%</span><br>",c+='<span style="white-space: nowrap">Clinton: '+b.clinton+"/"+b.clinton_precentage+"%</span><br>",c+='<span style="white-space: nowrap">Neutral: '+b.neutral+"/"+b.neutral_precentage+"%</span><br>"}function e(){if(map){var b=a.dataSet;Object.keys(b).forEach(function(c){var d=b[c].clinton,e=b[c].trump,f=b[c].neutral,g=d+e+f;b[c].total=g,b[c].trump_precentage=(100*e/g).toFixed(2),b[c].clinton_precentage=(100*d/g).toFixed(2),b[c].neutral_precentage=(100*f/g).toFixed(2),b[c].fillKey=a.plans[a.plan](b,c)}),map.updateChoropleth(a.dataSet,{reset:!0})}}var f=function(a,b){var c,d=a[b].clinton,e=a[b].trump,f=a[b].neutral,g=d+e+f;c=a[b].clinton_precentage>a[b].trump_precentage?"Democrat":"Republican";var h=g/a[b].electoralVotes,i="";return h>=1e3?i="Heavy ":h>=100&&(i="Light "),i+c},g=function(a,b){var c,d=a[b].clinton,e=a[b].trump,f=a[b].neutral,g=d+e+f;if(c=d>e?"Democrat":"Republican",d==e)return"Neutral";var h="";return upper_light>g?h="Light ":g>=upper_medium&&(h="Heavy "),h+c},h=function(a,b){var c,d=a[b].trump_precentage-a[b].clinton_precentage;return d>40?c="Heavy Republican":d>20?c="Republican":d>0?c="Light Republican":0==d?c="Neutral":-40>d?c="Heavy Democrat":-20>d?c="Democrat":0>d&&(c="Light Democrat"),c};a.plans={A:f,B:g,C:h},a.plan="B",a.get_plans=function(){return Object.keys(a.plans)},c.fetchDataSets(function(e){a.inputs=e,a.max=a.inputs.length-1,a.input=a.inputs[a.max],c.fetchInput(a.input,function(c){a.dataSet=c;var e={dom:"chart_1",width:800,height:400,scope:"usa",fills:b.fills(),data:a.dataSet,geographyConfig:{highlightBorderColor:"#bada55",popupTemplate:d},legend:!0,labels:!0};e.element=document.getElementById("container"),map=new Datamap(e),e.labels&&map.labels(),e.legend&&map.legend()})}),a.$watch("inputIndex",function(b){void 0!=a.inputs&&(a.input=a.inputs[b])}),a.$watch("input",function(b){b&&c.fetchInput(b,function(b){a.dataSet=b,e()})}),a.$watch("plan",function(b){console.log("plan: "+a.plan),e()})}]),angular.module("c2App").run(["$templateCache",function(a){a.put("views/map.html",'<div ng-controller="MapCtrl"> <h4 style="text-align:center">US Elections 2016 Tweet Counts</h4> <table> <tr> <td><span>Date</span></td> <td> <input id="slider" type="range" min="0" max="{{max}}" ng-model="inputIndex" value="0" width="200"> <span ng-bind="input"></span> </td> <td>&nbsp;&nbsp;&nbsp;&nbsp; Plan: <select ng-model="plan" ng-options="p for p in get_plans()"></select></td> </tr> </table> <div id="container" style="position: relative; width: 500px; height: 500px"></div> </div>')}]);